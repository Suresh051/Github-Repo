pipeline {
      agent {
            dockerfile {
                filename 'Dockerfile'
                dir 'cicd/docker'
                label 'Docker-enabled'
            }
        }
     environment {
        sfcc_ClientId  = credentials('CLIENT_ID')
        sfcc_Client_Secret  = credentials('CLIENT_SECRET')
       }
    stages {
        stage('Test') {
            steps {
              echo "Test"
            }
        }
      stage('Authorize DevHub') {
             steps{
	       script {
		 try {
		 sh 'sfcc-ci client:auth ${sfcc_ClientId} ${sfcc_Client_Secret}'
		 }
		 catch (err) {
                   echo "Caught: ${err}"
                   currentBuild.result = 'FAILURE'
                    }
		 
		}  
	   }	
        }
    }
}
