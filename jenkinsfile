pipeline {
agent {dockerfile true}
 parameters {
        choice choices: ['Dev', 'Staging', 'Production'], description: "Choose which environment to push changes to.", name: "DEPLOY_TO"
	gitParameter branch: '', branchFilter: '.*', defaultValue: '', name: '', quickFilterEnabled: false, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_TAG', useRepository: 'Github-Repo'
    }
   environment {
         SITEID = "lb"
        NOFLAGS = "0"
        DBNAME = "wpress_myproject"
        DBSERVER = "dbserver"
        DBUSER = "WordpressUser"
        DBPASS = "hiddenpassword"
        EXCLUDE = "domain_commentmeta,domain_comments"  // separate multiple tables with commas
        DEPLOY_TO = "${params.DEPLOY_TO}"
        DEPLOY_DB = "${params.DEPLOY_DB}"
    }
stages{
stage('Eample'){
steps {
echo 'Hello World!'
sh 'echo myCustomEnvVar=$myCustomEnvVar'
      }
   }
        stage("deploy-dev") {
	  when {
                allOf { 
                    environment ignoreCase: true, name: "DEPLOY_TO", value: "dev"; 
                    tag "release-*"
                }
            }
          steps {
		    script {
			    def tag = sh(returnStdout: true, script: "git tag --contains | head -1").trim()
                if (tag) {    
		     echo "${tag}"
                     echo "Deloying to dev"
                       }
                   }
                }   
				
		 }
   }
 }
