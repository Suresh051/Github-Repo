pipeline {
      agent {
            dockerfile {
                filename 'Dockerfile'
                dir 'cicd/docker'
                label 'Docker-enabled'
            }
        }
     environment {
        sfcc_ClientId  = credentials('CLIENT_ID')
        sfcc_Client_Secret  = credentials('CLIENT_SECRET')
       }
    stages {
        stage('Test') {
            steps {
              echo "Test"
            }
        }
      stage('Authorize DevHub') {
             steps{
	       script {
		  rc = command "sfcc-ci client:auth ${sfcc_ClientId} ${sfcc_Client_Secret}"
		  if (rc != 0) {
                   error 'Salesforce dev hub org authorization failed.'
                     }
		}  
	    }	
        }
    }
}
def command(script) {
    if (isUnix()) {
        return sh(returnStatus: true, script: script);
    } else {
        return bat(returnStatus: true, script: script);
    }	 
}

